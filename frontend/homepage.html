<!-- @Author: Casen Ward
     @Date: 2026-01-04
     @FileName: homepage.html
     @Brief: HTML for Stock Consensus Backtesting Application -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Stock Consensus - Backtest Engine</title>

  <!-- Neon/market vibe fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Urbanist:wght@400;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="homepage.css" />
  <style>
    /* Additional styles for backtest UI */
    .form-group {
      display: grid;
      gap: 8px;
      margin-bottom: 16px;
    }

    label {
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--fg);
    }

    select, input[type="text"] {
      padding: 11px 12px;
      border-radius: 10px;
      border: 1px solid var(--panel-border);
      background: var(--panel);
      color: var(--fg);
      font-family: inherit;
      font-size: 0.95rem;
      box-shadow: var(--inset-top);
      backdrop-filter: blur(6px);
      outline: none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }

    select:focus-visible, input[type="text"]:focus-visible {
      border-color: transparent;
      box-shadow: var(--inset-top), 0 0 0 2px var(--ring), 0 6px 18px rgba(61,225,255,.18);
    }

    .backtest-form {
      display: grid;
      gap: 16px;
    }

    .form-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .metric {
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      border: 1px solid rgba(132, 247, 255, 0.1);
    }

    .metric-label {
      font-size: 0.8rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent-2);
      font-family: "Share Tech Mono", monospace;
    }

    .metric-value.negative {
      color: #ff6b6b;
    }

    .trades-container {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 12px;
    }

    .trade-item {
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      border-left: 3px solid var(--accent-2);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .trade-item.loss {
      border-left-color: #ff6b6b;
    }

    .trade-return {
      font-weight: 700;
      font-family: "Share Tech Mono", monospace;
    }

    .return-positive {
      color: var(--accent-2);
    }

    .return-negative {
      color: #ff6b6b;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(132, 247, 255, 0.2);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 700;
      margin-left: 8px;
    }

    .status-badge.success {
      background: rgba(57, 255, 20, 0.2);
      color: var(--accent-2);
    }

    .status-badge.error {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
    }

    @media (max-width: 900px) {
      .form-inputs {
        grid-template-columns: 1fr;
      }
      .metrics-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <header class="hero">
      <h1 class="title">Stock <span>Backtest</span></h1>
      <p class="subtitle">Test your strategy against historical data</p>
    </header>

    <!-- Backtest Configuration Form -->
    <form id="backtest-form" class="panel backtest-form">
      <div class="form-inputs">
        <!-- Ticker Input -->
        <div class="form-group">
          <label for="ticker">Stock Ticker</label>
          <input id="ticker" type="text" placeholder="e.g., AAPL" required />
        </div>

        <!-- Strategy Selection -->
        <div class="form-group">
          <label for="strategy">Strategy</label>
          <select id="strategy" required>
            <option value="">-- Select Strategy --</option>
            <option value="mock">Mock Strategy</option>
          </select>
        </div>

        <!-- Time Period Selection -->
        <div class="form-group">
          <label for="time-period">Time Period</label>
          <select id="time-period" required>
            <option value="">-- Select Period --</option>
            <option value="1mo">1 Month</option>
            <option value="6mo">6 Months</option>
            <option value="1y">1 Year</option>
            <option value="5y">5 Years</option>
          </select>
        </div>
      </div>

      <button class="btn" type="submit">Run Backtest</button>
    </form>

    <!-- Results Panel -->
    <section id="results" class="panel" aria-live="polite">
      <div id="results-content" class="placeholder">
        <h2>Results</h2>
        <p>Configure your backtest parameters and click "Run Backtest" to see historical performance metrics.</p>
      </div>
    </section>

    <footer class="foot">
      <small>Stock Consensus Backtest Engine â€” Historical performance data powered by yfinance</small>
    </footer>
  </main>

  <script>
    const form = document.getElementById("backtest-form");
    const resultsDiv = document.getElementById("results-content");

    form.addEventListener("submit", async function(e) {
      e.preventDefault();

      const ticker = document.getElementById("ticker").value.trim().toUpperCase();
      const strategy = document.getElementById("strategy").value;
      const timePeriod = document.getElementById("time-period").value;

      if (!ticker || !strategy || !timePeriod) {
        showError("Please fill in all fields");
        return;
      }

      showLoading();

      try {
        const response = await fetch("http://127.0.0.1:8000/api/backtest", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            ticker: ticker,
            strategy: strategy,
            time_period: timePeriod
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        displayResults(data);
      } catch (err) {
        console.error("Error running backtest:", err);
        showError(`Failed to run backtest: ${err.message}`);
      }
    });

    function showLoading() {
      resultsDiv.innerHTML = `
        <div style="text-align: center; padding: 32px;">
          <div class="loading-spinner"></div>
          <p class="loading" style="margin-top: 16px;">Running backtest...</p>
        </div>
      `;
    }

    function showError(message) {
      resultsDiv.innerHTML = `
        <h2>Error <span class="status-badge error">FAILED</span></h2>
        <p class="error">${message}</p>
      `;
    }

    function formatCurrency(value) {
      return new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(value);
    }

    function formatPercent(value) {
      const sign = value >= 0 ? "+" : "";
      const className = value >= 0 ? "return-positive" : "return-negative";
      return `<span class="${className}">${sign}${value.toFixed(2)}%</span>`;
    }

    function displayResults(data) {
      const {
        ticker,
        start_date,
        end_date,
        num_trades,
        total_return_pct,
        win_rate_pct,
        avg_trade_duration_days,
        time_in_market_pct,
        max_drawdown_pct,
        trades
      } = data;

      let tradesHTML = "";
      if (trades && trades.length > 0) {
        tradesHTML = `
          <h3 style="margin-top: 20px;">Individual Trades (${trades.length} total)</h3>
          <div class="trades-container">
            ${trades.map((trade, idx) => {
              const returnClass = trade.return_pct >= 0 ? "return-positive" : "return-negative";
              const tradeItemClass = trade.return_pct < 0 ? "loss" : "";
              return `
                <div class="trade-item ${tradeItemClass}">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                    <strong>Trade #${idx + 1}</strong>
                    <span class="trade-return ${returnClass}">
                      ${trade.return_pct >= 0 ? "+" : ""}${trade.return_pct.toFixed(2)}%
                    </span>
                  </div>
                  <div style="font-size: 0.85rem; color: var(--muted);">
                    Entry: ${formatCurrency(trade.entry_price)} on ${trade.entry_date}
                  </div>
                  <div style="font-size: 0.85rem; color: var(--muted);">
                    Exit: ${formatCurrency(trade.exit_price)} on ${trade.exit_date}
                  </div>
                  <div style="font-size: 0.85rem; color: var(--muted);">
                    Duration: ${trade.duration_days} days
                  </div>
                </div>
              `;
            }).join("")}
          </div>
        `;
      }

      resultsDiv.innerHTML = `
        <h2>${ticker} <span class="status-badge success">SUCCESS</span></h2>
        <p style="color: var(--muted); margin: 8px 0;">
          Backtest Period: ${start_date} to ${end_date}
        </p>

        <div class="metrics-grid">
          <div class="metric">
            <div class="metric-label">Total Return</div>
            <div class="metric-value ${total_return_pct < 0 ? "negative" : ""}">
              ${total_return_pct >= 0 ? "+" : ""}${total_return_pct.toFixed(2)}%
            </div>
          </div>
          <div class="metric">
            <div class="metric-label">Win Rate</div>
            <div class="metric-value">${win_rate_pct.toFixed(1)}%</div>
          </div>
          <div class="metric">
            <div class="metric-label">Trades</div>
            <div class="metric-value">${num_trades}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Avg Trade Duration</div>
            <div class="metric-value">${avg_trade_duration_days.toFixed(1)} days</div>
          </div>
          <div class="metric">
            <div class="metric-label">Time in Market</div>
            <div class="metric-value">${time_in_market_pct.toFixed(1)}%</div>
          </div>
          <div class="metric">
            <div class="metric-label">Max Drawdown</div>
            <div class="metric-value negative">${max_drawdown_pct.toFixed(2)}%</div>
          </div>
        </div>

        ${tradesHTML}
      `;
    }
  </script>
</body>
</html>